{% extends "studentparent.html" %}
{% block body %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <h2 class="text-center mb-4" style="color: rgb(6,6,106)">Study Materials</h2>
        </div>
    </div>

    {% if debug_mode %}
    <div class="alert alert-info">
        <strong>Debug Mode:</strong> Showing all materials as no exact match found for your program/branch/year combination.
    </div>
    {% endif %}

    <div class="row">
        <div class="col-sm-12">
            {% if mat %}
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead style="background-color: #06066A; color: white;">
                            <tr>
                                <th>#</th>
                                <th>Course</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Upload Date</th>
                                <th>File Size</th>
                                <th>Created By</th>
                                <th>Version</th>
                                <th>Download</th>
                                <th>Preview</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for material in mat %}
                            <tr style="color: #495057;">
                                <td>{{ forloop.counter }}</td>
                                <td>{{ material.course.title|default:"N/A" }}</td>
                                <td>{{ material.title|truncatechars:30 }}</td>
                                <td>{{ material.description|truncatechars:50|default:"-" }}</td>
                                <td>{{ material.category.name|default:"-" }}</td>
                                <td>{{ material.created_at|date:"M d, Y" }}</td>
                                <td>{{ material.get_formatted_size }}</td>
                                <td>{{ material.created_by.username|default:"Unknown" }}</td>
                                <td>v{{ material.version }}</td>
                                <td>
                                    <a href="{% url 'studentapp:download_material' material.id %}" 
                                       class="btn btn-sm btn-primary">
                                        <i class="fas fa-download"></i> Download
                                    </a>
                                </td>
                                <td>
                                    {% if material.is_previewable %}
                                    <a href="{{ material.file.url }}" target="_blank" class="btn btn-sm btn-info">
                                        <i class="fas fa-eye"></i> Preview
                                    </a>
                                    {% else %}
                                    <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-warning text-center">
                    <h4><i class="fas fa-exclamation-triangle"></i> No Materials Found</h4>
                    <p>No study materials are currently available for your program, branch, and year combination.</p>
                    <p class="mb-0">Please contact your administrator if you believe this is an error.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Statistics Section -->
    {% if mat %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h6>Material Statistics</h6>
                    <div class="row">
                        <div class="col-md-4">
                            <strong>{{ mat|length }}</strong><br>
                            <small>Total Materials</small>
                        </div>
                        <div class="col-md-4">
                            <strong>{{ stu.program }}</strong><br>
                            <small>Your Program</small>
                        </div>
                        <div class="col-md-4">
                            <strong>{{ stu.branch }}</strong><br>
                            <small>Your Branch</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock body %}
